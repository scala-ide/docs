
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Architecture &#8212; Scala IDE 0.1-SNAPSHOT documentation</title>
    <link rel="stylesheet" href="../../_static/resources/stylesheets/base.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/resources/stylesheets/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/resources/stylesheets/base.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/resources/stylesheets/doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/resources/stylesheets/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/resources/stylesheets/prettify.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/jquery.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/toc.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/prettify.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/highlightCode.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/effects.core.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/effects.highlight.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/scrollTo.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/bootstrap-dropdown-app.js"></script>
    <script type="text/javascript" src="../../_static/resources/javascript/contentsFix.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="The Scala Presentation Compiler" href="presentation-compiler.html" />
    <link rel="prev" title="Building the Scala IDE" href="../building/building.html" /> 
  </head>
  <body>
<div class="top-bar">
  <div class="top-bar-inner">
    <div class="container">
      <a class="brand" href="/index.html"><img src="../../_static/resources/images/logo.png" height="70px"></a>
      <ul class="nav">
        <li><a href="/index.html#features">Features</a></li>
        <li><a href="/documentation.html">Documentation</a></li>
		<li class="menu">
	      	<a href="#" class="menu">Download</a>
	      	<ul class="menu-dropdown">
	        	<li><a href="/download/sdk.html">Bundle</a></li>
	        	<li><a href="/download/current.html">Stable</a></li>
	        	<li><a href="/download/milestone.html">Milestone</a></li>
	        	<li><a href="/download/nightly.html">Nightlies</a></li>
	      	</ul>
		</li>
        <li><a href="/blog/index.html">News</a></li>
        <li><a href="/team.html">Team</a></li>
      </ul>
    </div>
  </div>
</div>
<div class="slider">
  <div class="container">
    <div class="row">
      <div class="span16">
        <h1>Architecture</h1>
	  </div>
    </div>
  </div>
</div>
<div class="bottom">
  <div class="container" style="position: relative;">

    <div class="row" style="position: relative; clear: both;">
      <div class="span16">
          <ul class="breadcrumb">
            <li><a href="../../index.html">ScalaIDE Documentation</a> » </li>
              <li><a href="../index.html">Welcome to the Scala IDE Developer Documentation</a> » </li>
          </ul>
      </div>
    </div>

    <div class="row" style="position: relative; clear: both;">
      <div class="span11 main-content">
        <div class="section" id="architecture">
<h1>Architecture</h1>
<p>In this page you will learn about the Scala IDE’s architecture. First, an overview of the
different existing modules is provided. Then, a few specific aspects of the Scala IDE’s architecture
and its components are discussed.</p>
<div class="section" id="overview">
<h2>Overview</h2>
<p>The Scala IDE project is composed of several modules. Here is a generic description of what each module contains:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.core</span></code>: Contains the Scala IDE plug-in’s source code.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.core.tests</span></code>: Contains the functional tests used to exercise the Scala IDE in headless mode (with no User Interface).</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.debug</span></code>: Contains the Scala IDE debugger plug-in’s source code.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.debug.tests</span></code>: Contains the functional tests used to exercise the Scala IDE debugger in headless mode (with no User Interface).</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.debug.expression</span></code>: Contains Scala IDE expression evaluator plug-in’s source code.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.debug.expression.tests</span></code>: Contains the functional tests used to exercise the Scala IDE expression evaluator in headless mode (with no User Interface).</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.spy</span></code>: A Scala Spy view, used to display position, tree and type information under the cursor.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.aspects</span></code>: Contains the AspectJ classes used to weave into Eclipse and hook in JDT internals.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.build</span></code>: Contains the scripts for building the Scala IDE from the command line.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.build-toolchain</span></code>: Contains the script for retrieving and repackaging dependencies that are needed by the Scala IDE.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sbt.*</span></code>: Contain scripts for repackaging the Sbt incremental compiler as a Maven dependency.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.scala*</span></code>: Contain scripts for packaging Scala (2.10, 2.11) as features that can be installed in Eclipse</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.feature</span></code>: Packages the <code class="docutils literal"><span class="pre">org.scala-ide.sdt.core</span></code> and <code class="docutils literal"><span class="pre">org.scala-ide.sdt.debug</span></code> project binaries into the “Scala IDE for Eclipse” component, which is then made available through the Scala IDE update site.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.source.feature</span></code>: Packages both the <code class="docutils literal"><span class="pre">org.scala-ide.sdt.core</span></code> and <code class="docutils literal"><span class="pre">org.scala-ide.sdt.aspects</span></code> project sources into the “Scala IDE for Eclipse Source Feature” component, which is then made available through the Scala IDE update site.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.weaving.feature</span></code>: Packages the <code class="docutils literal"><span class="pre">org.scala-ide.sdt.aspects</span></code> project binaries into the “JDT Weaving for Scala” component, which is included within the “Scala IDE for Eclipse” component.</li>
<li><code class="docutils literal"><span class="pre">org.scala-ide.sdt.update-site</span></code>: Contains the result of a successful compilation of the Scala IDE project, packaged in the form expected by the Eclipse Update Manager.</li>
</ul>
</div>
<div class="section" id="the-build-system">
<h2>The Build system</h2>
<p>The Scala IDE build system is based on Maven and Tycho, but it has a few particularities. In most cases running the <code class="docutils literal"><span class="pre">build-all.sh</span></code> script should be sufficient, but in case you need to make changes or debug a failed nightly, the following information may prove useful.</p>
<div class="section" id="tycho">
<h3>Tycho</h3>
<p>Tycho brings Eclipse specific dependency management to Maven, essentially resolving <em>Require-Bundle</em> or <em>Import-Package</em> entries in <code class="docutils literal"><span class="pre">MANIFEST.MF</span></code> files. To this end it scans manifests early on in the build cycle and uses P2 repositories to locate the best match for each dependency. In other words, it builds a so-called <em>target-platform</em>, containing all the required bundles (jar files).</p>
</div>
<div class="section" id="pom-first">
<h3>POM-first</h3>
<p>In the real world not all dependencies will be available in P2 repositories. Tycho considers plain Maven (pom) dependencies as well, as long as the jar files have a <code class="docutils literal"><span class="pre">MANIFEST.MF</span></code> file. This is the case for Scala: the standard library, compiler and Scala modules (from 2.11 onwards) have correct <code class="docutils literal"><span class="pre">MANIFEST.MF</span></code> files, and the Scala IDE build is using them directly in its build.</p>
</div>
<div class="section" id="repackaging">
<h3>Repackaging</h3>
<p>In the worst case, the required dependency is only available as a plain jar, but no <code class="docutils literal"><span class="pre">MANIFEST</span></code> file is provided. The solution is to re-package them using the maven bundle plugin who generates a manifest. This is what the <code class="docutils literal"><span class="pre">org.scala-ide.sbt.full.library</span></code> and <code class="docutils literal"><span class="pre">org.scala-ide.sbt.compiler.interface</span></code> projects are doing for the Sbt incremental compiler.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Tycho requires pom-first dependencies to be available in a maven repository during the <em>initialize</em> maven lifecycle. This means that repackaged dependencies have to be built and published in a separate maven run. Listing them in the same parent pom as separate modules won’t cut it. This is the reason why we need the toolchain build.</p>
</div>
</div>
</div>
<div class="section" id="the-set-featues-step">
<h2>The set-featues step</h2>
<p>Currently we cross-build against Scala 2.10 and 2.11. Due to modularization, the Scala bundles we have to ship differ between the two versions, leading to different <code class="docutils literal"><span class="pre">features.xml</span></code> files in the two cases. Unfortunately, due to Tycho building the target platform so early in the build lifecycle, we cannot produce these files in the same maven run, or even the same build. This is handled by using the <code class="docutils literal"><span class="pre">set-features</span></code> profile in the root <code class="docutils literal"><span class="pre">pom.xml</span></code>, and called by <code class="docutils literal"><span class="pre">build.sh</span></code> before handing it over to the “main” build.</p>
</div>
<div class="section" id="scala-ide-eclipse-jdt">
<h2>Scala IDE &amp; Eclipse JDT</h2>
<p>The Scala IDE uses the <a class="reference external" href="http://eclipse.org/jdt/">Eclipse Java Development Tools (JDT)</a> weaving
in order to inherit as much as possible of the existing Eclipse Java functionality. AspectJ
and the weaving service of Eclipse (in fact, its OSGi container, called Equinox) allow us to
intercept method calls in the JDT, and provide Scala-specific implementations for things like the
<a class="reference external" href="https://github.com/scala-ide/scala-ide/blob/master/org.scala-ide.sdt.core/src/scala/tools/eclipse/ScalaSourceFileEditor.scala">source file editor</a>
or the <a class="reference external" href="https://github.com/scala-ide/scala-ide/blob/master/org.scala-ide.sdt.core/src/scala/tools/eclipse/javaelements/ScalaIndexBuilder.scala">indexer</a>.</p>
<p>By hooking into the JDT, and providing specific implementations of JDT interfaces, Scala entities
(classes, types, methods, etc) are seen by the JDT as Java elements, meaning:</p>
<ul class="simple">
<li>Java code completion “sees” Scala classes.</li>
<li>The Java presentation compiler “sees” errors when using Scala classes.</li>
<li>JDT tools, such as the JUnit runner, just ‘work’.</li>
<li>Lots of UI elements can be reused (the Outline View, Package Explorer, etc).</li>
</ul>
<p>Of course, Scala entities can not be faithfully represented in Java terms. Some Scala features will
be therefore only partially supported when working in mixed Java-Scala projects (for instance,
type members are represented as normal, value fields).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This will hopefully change in the near future, as we plan to create our own models for
representing Scala entities and hook that into JDT (rather than the current solution, where we
are using Java models to expose Scala entities).</p>
</div>
<p>Although not intended to be extended with other languages, the JDT offers extension points for some
functionality. Whenever possible, we prefer to use the regular, supported mechanism for extension,
instead of weaving. This is the case for both code completion and hyperlinking.</p>
<div class="section" id="jdt-weaving-and-java-integration">
<h3>JDT Weaving and Java integration</h3>
<p>All Scala aspect code is found in <code class="docutils literal"><span class="pre">org.scala-ide.sdt.aspects</span></code> project. This module defines:</p>
<ul class="simple">
<li>pointcuts and aspects to intercept JDT method calls,</li>
<li>Java interfaces and classes that are used by these aspects. The main IDE module, <code class="docutils literal"><span class="pre">org.scala-ide.sdt.core</span></code> implements or inherits these classes. This way, there is a clean separation between the hooks, and the actual implementations.</li>
</ul>
<p>The other side of this coin is the actual Scala-specific implementation in
<code class="docutils literal"><span class="pre">org.scala-ide.sdt.core</span></code>. The package <code class="docutils literal"><span class="pre">org.scalaide.core.internal.jdt.model</span></code> contains Scala
subclasses of Java element classes, such as <code class="docutils literal"><span class="pre">ScalaClassElement</span></code> or <code class="docutils literal"><span class="pre">ScalaDefElement</span></code>.</p>
<p>Although the JDT defines interfaces for these elements, we inherit from their internal
implementations. This makes our code prone to breakage in newer releases of the JDT, but gives us
much more functionality. In some cases it is even impossible to do otherwise, as the JDT code itself
casts such interfaces to their concrete, internal, implementations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As mentioned in the previous section, we plan to create our own models for representing Scala
entities. That will help us better representing Scala entities in the editor and it will
mitigate incompatibilities with newer version of the JDT.</p>
</div>
</div>
</div>
<div class="section" id="scala-ide-debugger">
<h2>Scala IDE debugger</h2>
<p>The Scala IDE debugger is using the standard Java debugging chain (JVMDI, JDWP and JDI) to provide a Scala specific debugger. The elements are displayed the Scala way, the names are decoded, and the actions are behaving the way a Scala developer would expect.</p>
<p>See also <a class="reference internal" href="expression-evaluator.html#expression-evaluator"><span class="std std-ref">Expression evaluation</span></a>.</p>
</div>
<div class="section" id="the-scala-structure-builder">
<h2>The Scala Structure Builder</h2>
<p>The workhorse of Java-Scala integration is the <a class="reference external" href="http://github.com/scala-ide/scala-ide/blob/master/org.scala-ide.sdt.core/src/org/scalaide/core/internal/jdt/model/ScalaStructureBuilder.scala">ScalaStructureBuilder</a>
class. This class translates Scala sources (using the Abstract Syntax Trees - AST) to the JDT model elements (using the
<a class="reference external" href="http://github.com/scala-ide/scala-ide/blob/master/org.scala-ide.sdt.core/src/org/scalaide/core/internal/jdt/model/ScalaElements.scala">Scala specific subclasses</a>,
of course), and it is fully responsible for the way the Eclipse Java compiler (and related JDT tools
or UI elements) sees Scala code.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This approach has some important limitation with respect to correct interoperation of mixed
Scala/Java code, and it is the source of several issues in the Scala IDE. One major point of
pain is that the Scala Structure Builder needs to faithfully emulate the Scala compiler to
provide correct interoperation between Scala and Java code. Doing this in general is:</p>
<ul class="simple">
<li>difficult, as we are somewhat trying to re-engineer what the compiler already does when it produces bytecode, and</li>
<li>fragile, as the produced bytecode may vary from one Scala version to another.</li>
</ul>
<p class="last">In the future we would like to explore other roads. For instance, we have been thinking about
using the binaries (instead of the sources), so that we would not need to duplicate the Scala
compiler backend’s logic. Though, doing this would force users working on mixed Scala/Java projects
to enable continuous build (to make sure that the class binaries are actually produced), which
may not be acceptable.</p>
</div>
</div>
<div class="section" id="the-scala-presentation-compiler">
<h2>The Scala Presentation Compiler</h2>
<p>In order to provide semantic actions, the IDE needs to <em>understand</em> the edited Scala code. That
means parsing and type-checking. <a class="reference internal" href="presentation-compiler.html#scalapresentationcompiler"><span class="std std-ref">The Scala Presentation Compiler</span></a> is an asynchronous front-end compiler for Scala, part of the standard Scala compiler.</p>
</div>
<div class="section" id="code-formatting">
<h2>Code formatting</h2>
<p>Code formatting is delegated to <a class="reference external" href="https://github.com/mdr/scalariform/">Scalariform</a>, a library for
automated Scala formatting written by Matt Russell. <a class="reference external" href="https://github.com/scala-ide/scala-ide/blob/master/org.scala-ide.sdt.core/src/org/scalaide/ui/internal/actions/ScalaStructureSelectEnclosingAction.scala">Structured selection</a>
and <a class="reference external" href="https://github.com/mdr/Scala-IDE/blob/f1a02cd3455aead4582a1652beddcc0b3dbd0f10/org.scala-ide.sdt.core/src/org/scalaide/core/internal/lexical/ScalaCodeScanner.scala">tokenising</a>
for syntax coloring are also backed by Scalariform.</p>
</div>
<div class="section" id="refactoring">
<h2>Refactoring</h2>
<p>Refactoring is delegated to the <a class="reference external" href="http://scala-refactoring.org/">scala-refactoring</a> library written
by Mirko Stocker.</p>
</div>
</div>

	    </div>
      <div class="span5 sidebar">
        <p class="contents-title">Contents</p>
        <div id="scroller-anchor">
          <div id="scroller">
            <div id="toc"></div>
          </div>
        </div>
	    </div>
    </div>

  </div>
</div>
<div class="footer" style="position:relative; clear: both; ">
  <div class="container">
    <ul>
      <li><h5>Download</h5></li>
      <li><a href="/download/sdk.html">Bundle</a></li>
      <li><a href="/download/current.html">Stable</a></li>
      <li><a href="/download/milestone.html">Milestone</a></li>
      <li><a href="/download/nightly.html">Nightlies</a></li>
    </ul>
    <ul>
      <li><h5>Documentation</h5></li>
      <li><a href="/docs/user/gettingstarted.html">Getting Started</a></li>
      <li><a href="/docs/videos.html">Videos</a></li>
      <li><a href="/docs/tutorials/index.html">Tutorials</a></li>
      <li><a href="http://groups.google.com/group/scala-ide-user">User Mailing List</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="https://github.com/scala-ide/scala-ide">Source Code</a></li>
      <li><a href="/docs/dev/index.html">Developer Documentation</a></li>
      <li><a href="http://groups.google.com/group/scala-ide-dev">Developer Mailing List</a></li>
      <li><a href="http://scala-ide-portfolio.assembla.com/spaces/scala-ide/support/tickets">Report a Bug</a></li>
      <li><a href="http://www.typesafe.com/contribute/cla">Individual CLA</a></li>
      <li><a href="/resources/pdfs/cla-org.pdf">Organization CLA</a></li>
    </ul>
    <ul>
      <li><img src="../../_static/resources/images/watermark.png" align="center"/></li>
    </ul>
  </div>
  <div class="container copyright">
    <p>
      <a href="http://creativecommons.org/licenses/by/2.0/uk/">Creative Commons</a>
	  <a href="http://scala-ide.org/feed.rss"><img align="right" height="20px" width="20px" src="http://scala-ide.org/resources/images/rss.png" alt="RSS feed of updates to the Scala IDE blog"></a>
    </p>
  </div>
</div>
<script type="text/javascript">
  $('#toc').toc();
</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-574683-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  function startVideo(div_id, youtube_id) {
    var video = '<iframe class="doc_video" src="http://www.youtube.com/embed/' + youtube_id + '?rel=0&autoplay=1&vq=hd720" frameborder="0" allowfullscreen></iframe>';
    document.getElementById(div_id).innerHTML = video
  }


</script>

  </body>
</html>